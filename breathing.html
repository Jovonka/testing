<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Breathing Sphere Interaction</title>
  <style>
    * { box-sizing: border-box; }

    html, body {
      width: 100%;
      height: 100%;
      margin: 0;
      background-color: rgb(255, 254, 245);
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      perspective: 1000px;
      overflow: hidden;
      font-family: sans-serif;
    }

    /* Top header */
    .header {
      position: absolute;
      top: 2rem;
      font-size: 2rem;
      font-weight: bold;
      color: #ff8c42;
      opacity: 0;
      transition: opacity 0.5s ease;
      pointer-events: none;
    }
    .header.show {
      opacity: 1;
    }

    /* Scene container */
    .scene {
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: transform 0.6s cubic-bezier(0.25, 1, 0.3, 1);
      transform: scale(1);
    }
    .scene.expanded {
      transform: scale(1.6);
    }

    /* Ripple Rings - always visible */
    .b {
      height: 220px;
      width: 220px;
      animation: spin 7s linear infinite;
      transform-style: preserve-3d;
      position: relative;
    }
    .c {
      height: 220px;
      width: 220px;
      border: 1px solid #F06;
      border-radius: 99em;
      position: absolute;
      top: 0; left: 0; right: 0; bottom: 0;
      margin: auto;
    }
    @keyframes spin {
      from { transform: rotateY(0deg) rotateX(0deg) rotateZ(0deg); }
      to { transform: rotateY(360deg) rotateX(-360deg) rotateZ(360deg); }
    }

    /* Sphere - fades in/out */
    .sphere {
      position: absolute;
      top: 0; right: 0; bottom: 0; left: 0;
      margin: auto;
      width: 45vmin;
      height: 45vmin;
      transform-style: preserve-3d;
      pointer-events: none;
      opacity: 0;
      transition: opacity 0.8s ease;
    }
    .sphere.visible {
      opacity: 1;
    }
    .sphere.spin {
      animation: spinSphere 20s infinite linear;
    }

    [class^="ring"] {
      position: absolute;
      top: 0; right: 0; bottom: 0; left: 0;
      margin: auto;
      width: 45vmin;
      height: 45vmin;
      border-radius: 50%;
      overflow: hidden;
    }

    @keyframes spinSphere {
      from { transform: rotateZ(0deg) rotateX(0deg) rotateY(0deg); }
      to { transform: rotateZ(360deg) rotateX(-360deg) rotateY(360deg); }
    }

    /* Progress bar container */
    .progress-container {
      position: absolute;
      bottom: 2rem;
      width: 60%;
      max-width: 400px;
      height: 20px;
      background: rgba(0,0,0,0.1);
      border-radius: 10px;
      overflow: hidden;
      opacity: 0;
      transition: opacity 0.5s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      pointer-events: none;
    }
    .progress-container.show {
      opacity: 1;
    }

    /* Progress bar itself */
    .progress-bar {
      position: absolute;
      top: 0; left: 0;
      height: 100%;
      width: 0%;
      background: linear-gradient(90deg, #ffcc33, #ff6633);
      transition: width 0.1s linear;
    }

    /* Countdown text */
    .countdown {
      position: relative;
      z-index: 1;
      font-weight: bold;
      color: #fff;
      text-shadow: 0 0 4px rgba(0,0,0,0.3);
      font-size: 1rem;
    }
  </style>
</head>
<body>

  <div class="header" id="header">Breathe In</div>

  <div class="scene" id="scene">
    <!-- Ripple rings always visible -->
    <div class="b" id="rings"></div>
    <!-- Sphere fades in/out -->
    <div class="sphere" id="sphere"></div>
  </div>

  <div class="progress-container" id="progressContainer">
    <div class="progress-bar" id="progressBar"></div>
    <div class="countdown" id="countdown">3</div>
  </div>

  <script>
    // Generate ripple rings (ALWAYS VISIBLE)
    const ringsContainer = document.getElementById('rings');
    const numRings = 45;
    let colorHue = 330;
    for (let i = 1; i <= numRings; i++) {
      const c = document.createElement('div');
      c.className = 'c';
      c.style.borderColor = `hsl(${colorHue}, 100%, 50%)`;
      c.style.animation = `spin ${numRings * 0.16}s linear ${i * 0.04}s infinite`;
      c.style.opacity = (i * 0.006).toFixed(3);
      ringsContainer.appendChild(c);
      colorHue = (colorHue + 2) % 360;
    }

    // Generate sphere rings
    const sphereContainer = document.getElementById('sphere');
    const ringCount = 36;
    const startHue = 60;
    const endHue = 30;
    for (let i = 1; i <= ringCount; i++) {
      const ring = document.createElement('div');
      ring.className = `ring${i}`;
      const hue = startHue - ((startHue - endHue) * (i / ringCount));
      const blur = 2 + (i * 2.2);
      ring.style.transform = `rotateY(${i * 2}deg) rotateX(${i * 2}deg) rotateZ(${i * 3}deg)`;
      ring.style.boxShadow = `
        0 0 ${blur}px hsla(${hue}, 90%, 55%, 0.25),
        inset 0 0 ${blur}px hsla(${hue}, 90%, 55%, 0.3)
      `;
      sphereContainer.appendChild(ring);
    }

    const sphere = document.getElementById('sphere');
    const header = document.getElementById('header');
    const progressContainer = document.getElementById('progressContainer');
    const progressBar = document.getElementById('progressBar');
    const countdown = document.getElementById('countdown');
    const scene = document.getElementById('scene');

    let countdownTimer = null;
    let progressInterval = null;
    const totalTime = 3000;

    function restartSphereAnimation() {
      sphere.classList.remove('spin');
      // Force reflow to reset animation
      void sphere.offsetWidth;
      sphere.classList.add('spin');
    }

    function startBreathing() {
      restartSphereAnimation();
      sphere.classList.add('visible');
      scene.classList.add('expanded');
      header.classList.add('show');
      progressContainer.classList.add('show');

      let remaining = 3;
      countdown.textContent = remaining;
      progressBar.style.width = '0%';

      const startTime = Date.now();
      progressInterval = setInterval(() => {
        const elapsed = Date.now() - startTime;
        const progress = Math.min(elapsed / totalTime, 1);
        progressBar.style.width = `${progress * 100}%`;
      }, 50);

      countdownTimer = setInterval(() => {
        remaining -= 1;
        countdown.textContent = remaining;
        if (remaining < 1) {
          clearInterval(countdownTimer);
        }
      }, 1000);
    }

    function stopBreathing() {
      sphere.classList.remove('visible');
      scene.classList.remove('expanded');
      header.classList.remove('show');
      progressContainer.classList.remove('show');
      clearInterval(countdownTimer);
      clearInterval(progressInterval);
      progressBar.style.width = '0%';
      countdown.textContent = '3';
    }

    document.addEventListener('mousedown', startBreathing);
    document.addEventListener('mouseup', stopBreathing);
    document.addEventListener('touchstart', startBreathing);
    document.addEventListener('touchend', stopBreathing);
  </script>
</body>
</html>
