<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Breathing Sphere Interaction</title>
<style>
  * { box-sizing: border-box; margin:0; padding:0; }

  html, body {
    width: 100%;
    height: 100%;
    overflow: hidden;
    font-family: sans-serif;
    display: flex;
    align-items: center;
    justify-content: center;
    background-color: rgb(255,254,245);

    /* Disable selection/highlight */
    user-select: none;
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    -webkit-tap-highlight-color: transparent;
  }

  .header {
    position: absolute;
    top: 2vh;
    font-size: 4vw;
    font-weight: bold;
    color: #ff8c42;
    opacity: 0;
    transition: opacity 0.5s ease;
    pointer-events: none;
  }
  .header.show { opacity: 1; }

  .scene {
    position: relative;
    display: flex;
    align-items: center;
    justify-content: center;
    transform: scale(1);
    transition: transform 0.6s cubic-bezier(0.25,1,0.3,1);
  }
  .scene.expanded { transform: scale(1.4); }

  /* Ripple Rings */
  .b {
    width: 50vmin;
    height: 50vmin;
    position: relative;
    transform-style: preserve-3d;
    animation: spin 15s linear infinite;
  }
  .c {
    position: absolute;
    top:0; left:0; right:0; bottom:0;
    margin:auto;
    width: 50vmin;
    height: 50vmin;
    border-radius: 50%;
    border: 1px solid #F06;
  }
  @keyframes spin {
    from { transform: rotateY(0deg) rotateX(0deg) rotateZ(0deg);}
    to { transform: rotateY(360deg) rotateX(-360deg) rotateZ(360deg);}
  }

  /* Sphere Rings */
  .sphere {
    position: absolute;
    top:0; left:0; right:0; bottom:0;
    margin:auto;
    width: 50vmin;
    height: 50vmin;
    opacity: 0;
    transform-style: preserve-3d;
    transition: opacity 0.8s ease;
    pointer-events: none;
  }
  .sphere.visible { opacity:1; }
  [class^="ring"] {
    position: absolute;
    top:0; left:0; right:0; bottom:0;
    margin:auto;
    width:50vmin;
    height:50vmin;
    border-radius: 50%;
    overflow:hidden;
  }

  /* Progress */
  .progress-container {
    position: absolute;
    bottom: 4vh;
    width: 60%;
    max-width: 400px;
    height: 4vh;
    background: rgba(0,0,0,0.1);
    border-radius: 2vh;
    overflow: hidden;
    opacity:0;
    transition: opacity 0.5s ease;
    display:flex;
    align-items:center;
    justify-content:center;
    pointer-events:none;
  }
  .progress-container.show { opacity:1; }

  .progress-bar {
    position: absolute;
    top:0; left:0;
    height:100%;
    width:0%;
    background: linear-gradient(90deg,#ffcc33,#ff6633);
  }

  .countdown {
    position: relative;
    z-index:1;
    color:#fff;
    font-weight:bold;
    text-shadow:0 0 4px rgba(0,0,0,0.3);
    font-size: 3vw;
  }
</style>
</head>
<body>

<div class="header" id="header">Breathe In</div>

<div class="scene" id="scene">
  <div class="b" id="rings"></div>
  <div class="sphere" id="sphere"></div>
</div>

<div class="progress-container" id="progressContainer">
  <div class="progress-bar" id="progressBar"></div>
  <div class="countdown" id="countdown">3</div>
</div>

<script>
const ringsContainer = document.getElementById('rings');
const numRings = 45;
let colorHue = 330;
for(let i=1;i<=numRings;i++){
  const c = document.createElement('div');
  c.className='c';
  c.style.borderColor=`hsl(${colorHue},100%,50%)`;
  c.style.opacity=(i*0.006).toFixed(3);
  ringsContainer.appendChild(c);
  colorHue=(colorHue+2)%360;
}

const sphereContainer = document.getElementById('sphere');
const ringCount = 36;
const startHue=60,endHue=30;
for(let i=1;i<=ringCount;i++){
  const ring = document.createElement('div');
  ring.className=`ring${i}`;
  const hue = startHue - ((startHue-endHue)*(i/ringCount));
  const blur = 2+(i*2.2);
  ring.style.transform=`rotateY(${i*2}deg) rotateX(${i*2}deg) rotateZ(${i*3}deg)`;
  ring.style.boxShadow=`0 0 ${blur}px hsla(${hue},90%,55%,0.25), inset 0 0 ${blur}px hsla(${hue},90%,55%,0.3)`;
  sphereContainer.appendChild(ring);
}

const sphere = document.getElementById('sphere');
const header = document.getElementById('header');
const progressContainer = document.getElementById('progressContainer');
const progressBar = document.getElementById('progressBar');
const countdown = document.getElementById('countdown');
const scene = document.getElementById('scene');

let countdownTimer=null;
let startTime=null;
const totalTime=3000;

function restartSphereAnimation(){
  sphere.style.animation='none';
  void sphere.offsetWidth;
  sphere.style.animation='spinSphere 20s linear infinite';
}

function startBreathing(){
  restartSphereAnimation();
  sphere.classList.add('visible');
  scene.classList.add('expanded');
  header.classList.add('show');
  progressContainer.classList.add('show');

  let remaining=3;
  countdown.textContent=remaining;
  progressBar.style.width='0%';
  startTime=performance.now();

  function animate(){
    const elapsed = performance.now()-startTime;
    const progress=Math.min(elapsed/totalTime,1);
    progressBar.style.width=`${progress*100}%`;
    if(progress<1) requestAnimationFrame(animate);
  }
  requestAnimationFrame(animate);

  countdownTimer=setInterval(()=>{
    remaining--;
    countdown.textContent=remaining>0?remaining:0;
    if(remaining<1) clearInterval(countdownTimer);
  },1000);
}

function stopBreathing(){
  sphere.classList.remove('visible');
  scene.classList.remove('expanded');
  header.classList.remove('show');
  progressContainer.classList.remove('show');
  clearInterval(countdownTimer);
  progressBar.style.width='0%';
  countdown.textContent='3';
}

document.addEventListener('mousedown',startBreathing);
document.addEventListener('mouseup',stopBreathing);
document.addEventListener('touchstart',startBreathing);
document.addEventListener('touchend',stopBreathing);

// Add smooth sphere spin animation
const style = document.createElement('style');
style.innerHTML=`@keyframes spinSphere{from{transform:rotateZ(0deg) rotateX(0deg) rotateY(0deg);}to{transform:rotateZ(360deg) rotateX(-360deg) rotateY(360deg);}}`;
document.head.appendChild(style);
sphere.style.animation='spinSphere 20s linear infinite';
</script>

</body>
</html>
